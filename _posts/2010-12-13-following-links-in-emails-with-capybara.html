---
layout: post
title: Following links in emails with Capybara
tags:
- General
status: publish
type: post
published: true
meta:
  _wp_old_slug: ''
  _edit_last: '1'
---
Although this just got <a href="https://github.com/jnicklas/capybara/commit/78c5812b6eed0a78cd39933d7b78c260245830ea">added to the Capybara README</a>, I thought it worth a quick note here. 

<blockquote>When using Rack::Test, beware if attempting to visit absolute URLs. For example, a session might not be shared between visits to <i>posts_path</i> and <i>posts_url</i>. If testing an absolute URL in an Action Mailer email, set <i>default_url_options</i> to match the Rails default of <i>www.example.com</i>.</blockquote>

So, for a Rails app, you'd add this to your <i>config/environments/test.rb</i> file:

<pre>config.action_mailer.default_url_options = {:host => 'www.example.com'}</pre>

Otherwise, you'll find yourself losing your user session between requests (steps) in your test. 
